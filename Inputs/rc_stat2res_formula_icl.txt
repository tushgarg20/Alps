#Unit	GSIM residency			
#Instance Counts				
	num_Fabric_LSN	=		 numSlices	
	num_Fabric_Repeaters	= numSlices	
	num_Fabric_TopLevel	= numSlices	
	num_Fabric_BGF	= (numSlices>2)? 2:((numSlices<2)? 0:1)
				
#Generic				
	.CrClk	=	D(CrClock.Clocks)	
	 .GeoClk2x	=	D(SUM('2xGeoClock\.Clocks'))	
	 numSlices	=	knob.global.NumSlices	
	 numBuses        =       D(SUM('knob.*\.S0.uL3.NumUpFabricBus'))+D(SUM('knob.*\.S0.uL3.NumDownFabricBus'))+D(SUM('knob.*\.S0.uL3.NumLateralFabricBus'))
	 @anytraffic@	=	(VC0_TCC0|VC1_TCC1|VC1_TCC0|VC1_TCC1|VCC2)	
				
#Fabric				
	
	PS0_Fabric_CMD	=	1-((.temp_LSN_CMD_between_slices + .temp_LSN_CMD_between_unslice)/(numSlices*.CrClk*numBuses))	
	PS0_Fabric_DATA	=	1-((.temp_LSN_DATA_between_slices + .temp_LSN_DATA_between_unslice)/(numSlices*.CrClk*numBuses))	

#LSN				
	.temp_CMD_traffic_from_unslice	=	D(SUM('S0.uL3.LSN.CmdDownInVCBuf\d+_@anytraffic@.pushed'))	
	.temp_DATA_traffic_from_unslice	=	D(SUM('S0.uL3.LSN.DataDownInVCBuf\d+_@anytraffic@.pushed'))	
				
	.temp_CMD_traffic_to_unslice	=	D(SUM('uGAM.GACB.InputQ_\d+.pushed'))	
	.temp_DATA_traffic_to_unslice	=	D(SUM('uGAFS.FabricDataInBuf_\d+.pushed'))+ D(SUM('uGAM.GACB.InputDataQ_\d+.pushed'))	
				
	.temp_CMD_traffic_between_slices	=	D(SUM('S\d+.uL3.LSN.CmdDownInVCBuf\d+_@anytraffic@.pushed'))+D(SUM('S\d+.uL3.LSN.CmdUpInVCBuf\d+_@anytraffic@.pushed'))-.temp_CMD_traffic_from_unslice	
	.temp_DATA_traffic_between_slices	=	D(SUM('S\d+.uL3.LSN.DataDownInVCBuf\d+_@anytraffic@.pushed'))+D(SUM('S\d+.uL3.LSN.DataUpInVCBuf\d+_@anytraffic@.pushed'))-.temp_DATA_traffic_from_unslice	
				
	.temp_LSN_CMD_between_slices	=	(.temp_CMD_traffic_between_slices)	
	.temp_LSN_DATA_between_slices	=	(.temp_DATA_traffic_between_slices)	
				
	.temp_LSN_CMD_between_unslice	=	(.temp_CMD_traffic_from_unslice + .temp_CMD_traffic_to_unslice)	
	.temp_LSN_DATA_between_unslice	=	(.temp_DATA_traffic_from_unslice + .temp_DATA_traffic_to_unslice)	
				
	PS2_Fabric_LSN_CMD_S2S	=	(.temp_LSN_CMD_between_slices)/(numSlices*.CrClk*numBuses)	
	PS2_Fabric_LSN_DATA_S2S	=	(.temp_LSN_DATA_between_slices)/(numSlices*.CrClk*numBuses)

	PS2_Fabric_LSN_CMD_U2S	=	(.temp_LSN_CMD_between_unslice)/(numSlices*.CrClk*numBuses)	
	PS2_Fabric_LSN_DATA_U2S	=	(.temp_LSN_DATA_between_unslice)/(numSlices*.CrClk*numBuses)

				
#Repeaters				
	PS2_Fabric_Repeaters_CMD_S2S	=	(.temp_LSN_CMD_between_slices)/(numSlices*.CrClk*numBuses)			
	PS2_Fabric_Repeaters_DATA_S2S	=	(.temp_LSN_DATA_between_slices)/(numSlices*.CrClk*numBuses)

	PS2_Fabric_Repeaters_CMD_U2S	=	(.temp_LSN_CMD_between_unslice)/(numSlices*.CrClk*numBuses)	
	PS2_Fabric_Repeaters_DATA_U2S	=	(.temp_LSN_DATA_between_unslice)/(numSlices*.CrClk*numBuses)


				
#Unslice BGF				
	PS0_Fabric_BGF_CMD	=       1-PS2_Fabric_BGF_CMD
	PS0_Fabric_BGF_DATA	=	1-PS2_Fabric_BGF_DATA
	PS2_Fabric_BGF_CMD	=	 (.temp_LSN_CMD_between_unslice)/(.CrClk*numBuses)
	PS2_Fabric_BGF_DATA	=        (.temp_LSN_DATA_between_unslice)/(.CrClk*numBuses)
				
#TopLevel				
	PS2_Fabric_Top_Level	=	1	

